<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>canvas求婚案例</title>
		<style>
			*{
				margin: 0;
				padding: 0;
			}
			canvas{
				display: block;
				margin: 20px auto;
				border: 1px solid #f00;
				background: #F9D9B2;
			}
			
		</style>
	</head>
	<body>
		<canvas id="canvas" width="1200" height="610"></canvas>
		<script type="text/javascript">
			function bac(){
				var canvas=document.getElementById("canvas");
				var ctx=canvas.getContext('2d');
				flower();
				function flower(){
					var num=Math.ceil(Math.random()*10+20);
					for(var i=0;i<num;i++){
						img_flower=new Image();
						img_flower.src="img/3.png";
						img_flower.onload=function(){
							var widths=Math.ceil(Math.random()*70+20);
							var x=Math.random()*1100;
							var y=Math.random()*550;
							ctx.drawImage(img_flower,x,y,widths,widths);
						}
					}
				}
				backg();
				function backg(){
					//背景
					img_one=new Image();
					img_one.src="img/1.png";
					img_one.onload=function(){
						ctx.drawImage(img_one,50,150,1100,460);
					}
				}
				dear();
				function dear(){
					//亲爱的我们结婚吧
					img_two=new Image();
					img_two.src="img/2.png";
					img_two.onload=function(){
						ctx.drawImage(img_two,400,150,400,50);
					}
				}
				lefimg();
				function lefimg(){
					//左圈
					img_thr=new Image();
					img_thr.src="img/4.png";
					img_thr.onload=function(){
						ctx.drawImage(img_thr,250,230,140,129);
					}
					//好
					img_fiv=new Image();
					img_fiv.src="img/6.png";
					img_fiv.onload=function(){
						ctx.drawImage(img_fiv,290,275,51,44);
					}
				}
				var x1=800,y1=230,w1=140,h1=129;
				rigimg(x1,y1);
				function rigimg(xx1,yy1){
					//右圈
					img_for=new Image();
					img_for.src="img/5.png";
					img_for.onload=function(){
						ctx.drawImage(img_for,xx1,yy1,w1,h1);
					}
					//不好
					img_six=new Image();
					img_six.src="img/7.png";
					img_six.onload=function(){
						ctx.drawImage(img_six,(xx1+26),(yy1+45),99,44);
					}
				}
				function heart(){
					//心
					img_sev=new Image();
					img_sev.src="img/8.png";
					img_sev.onload=function(){
						ctx.drawImage(img_sev,435,130,300,213);
					}
				}
				canvas.onmousemove=function(ev){
					var cliX=ev.clientX-canvas.offsetLeft;
					var cliY=ev.clientY-canvas.offsetTop;
					if(cliX>=x1&&cliX<=(x1+w1)&&cliY>=y1&&cliY<=(y1+h1)){
						ctx.clearRect(0,0,1200,610);
						flower();
						backg();
						dear();
						lefimg();
						x1=Math.random()*1000;
						y1=Math.random()*500;
						rigimg(x1,y1);
					}
				}
				canvas.onclick=function(ev){
					var cliX=ev.clientX-canvas.offsetLeft;
					var cliY=ev.clientY-canvas.offsetTop;
					if(cliX>=250&&cliX<=390&&cliY>=230&&cliY<=359){
						canvas.onmousemove=null;
						ctx.clearRect(0,0,1200,610);
						flower();
						backg();
						heart();
					}
				}
			}
			
			window.addEventListener("load",bac,false);
		</script>
	</body>
</html>
